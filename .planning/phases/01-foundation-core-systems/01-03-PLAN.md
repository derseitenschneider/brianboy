---
phase: 01-foundation-core-systems
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - astro.config.mjs
  - src/i18n/ui.ts
  - src/components/LanguageSwitch.astro
  - src/layouts/BaseLayout.astro
  - src/pages/index.astro
  - src/pages/en/index.astro
autonomous: true

must_haves:
  truths:
    - "User can visit / and see German content"
    - "User can visit /en/ and see English content"
    - "User can switch between languages using the language switcher"
    - "html lang attribute matches current language"
  artifacts:
    - path: "src/i18n/ui.ts"
      provides: "Translation strings and helper functions"
      exports: ["languages", "defaultLang", "ui", "getLangFromUrl", "useTranslations", "getLocalizedPath"]
    - path: "src/components/LanguageSwitch.astro"
      provides: "Language switcher component"
      contains: "languages"
    - path: "src/pages/en/index.astro"
      provides: "English homepage"
      contains: "lang=\"en\""
    - path: "astro.config.mjs"
      provides: "i18n routing configuration"
      contains: "prefixDefaultLocale: false"
  key_links:
    - from: "src/layouts/BaseLayout.astro"
      to: "src/i18n/ui.ts"
      via: "Language detection"
      pattern: "getLangFromUrl"
    - from: "src/components/LanguageSwitch.astro"
      to: "src/i18n/ui.ts"
      via: "Translation imports"
      pattern: "import.*languages.*getLocalizedPath"
    - from: "astro.config.mjs"
      to: "i18n config"
      via: "Routing configuration"
      pattern: "prefixDefaultLocale:\\s*false"
---

<objective>
Implement bilingual routing with German at root (/) and English at /en/

Purpose: The site must be accessible in both German and English for different audiences (Swiss locals vs. international Eleno users). German is the default since the primary audience is Swiss.

Output: Working i18n routing with language switcher component
</objective>

<execution_context>
@/Users/brianboy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brianboy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-core-systems/01-RESEARCH.md
@.planning/phases/01-foundation-core-systems/01-02-SUMMARY.md

Critical research findings:
1. Use prefixDefaultLocale: false for German at /, English at /en/
2. Create helper functions: getLangFromUrl, useTranslations, getLocalizedPath
3. Each language needs its own page files (src/pages/en/*)
4. html lang attribute must be dynamic based on current language
5. Fallback logic: ui[lang][key] || ui[defaultLang][key]
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Astro i18n and create translation helpers</name>
  <files>
    astro.config.mjs
    src/i18n/ui.ts
  </files>
  <action>
Update astro.config.mjs to add i18n configuration:

```javascript
i18n: {
  defaultLocale: "de",
  locales: ["de", "en"],
  routing: {
    prefixDefaultLocale: false, // German at /, English at /en/
  },
},
```

Create src/i18n/ui.ts with:

1. languages object: { de: "Deutsch", en: "English" }
2. defaultLang constant: "de"
3. ui object with translations:
   ```typescript
   de: {
     "nav.home": "Startseite",
     "nav.about": "Uber mich",
     "theme.toggle": "Farbschema wechseln",
     "lang.switch": "Sprache wechseln",
     "site.title": "Brian Boy",
     "site.description": "Tech-Unternehmer und Musiker",
     "hero.greeting": "Hallo, ich bin",
     "hero.tagline": "Tech-Unternehmer & Musiker",
   },
   en: {
     "nav.home": "Home",
     "nav.about": "About",
     "theme.toggle": "Toggle theme",
     "lang.switch": "Switch language",
     "site.title": "Brian Boy",
     "site.description": "Tech entrepreneur and musician",
     "hero.greeting": "Hi, I'm",
     "hero.tagline": "Tech Entrepreneur & Musician",
   },
   ```

4. Helper functions:
   - getLangFromUrl(url: URL): Extract language from URL path
   - useTranslations(lang): Returns t() function for translations with fallback
   - getLocalizedPath(lang, path): Generate correct URL for language

Type the helpers properly with TypeScript.
  </action>
  <verify>
    astro.config.mjs contains i18n block
    src/i18n/ui.ts exists and exports all helpers
    TypeScript compiles without errors
  </verify>
  <done>
    - astro.config.mjs has i18n with prefixDefaultLocale: false
    - ui.ts exports languages, defaultLang, ui, getLangFromUrl, useTranslations, getLocalizedPath
    - All helpers are properly typed
  </done>
</task>

<task type="auto">
  <name>Task 2: Create LanguageSwitch component and update BaseLayout</name>
  <files>
    src/components/LanguageSwitch.astro
    src/layouts/BaseLayout.astro
  </files>
  <action>
Create src/components/LanguageSwitch.astro:

1. Frontmatter:
   - Import languages, getLangFromUrl, getLocalizedPath from "../i18n/ui"
   - Get current lang from Astro.url
   - Extract pathname without language prefix

2. Template:
   - nav element with aria-label="Language selection"
   - Map over Object.entries(languages)
   - Each language as an anchor:
     - href from getLocalizedPath(code, pathname)
     - Conditional styling: active language has bg-gray-200 dark:bg-gray-700
     - Inactive has hover state
     - aria-current="page" for active language
   - Display language label (Deutsch/English)

Update src/layouts/BaseLayout.astro:

1. Import i18n helpers: getLangFromUrl, useTranslations
2. Import LanguageSwitch component
3. Get lang from Astro.url
4. Get t function from useTranslations(lang)
5. Update html tag: lang={lang}
6. Add LanguageSwitch to header (next to ThemeToggle)
7. Update ThemeToggle aria-label to use t("theme.toggle")

The header should have both ThemeToggle and LanguageSwitch visible.
  </action>
  <verify>
    Both files exist and updated
    BaseLayout html tag has dynamic lang
    LanguageSwitch shows both language options
    Active language is visually indicated
  </verify>
  <done>
    - LanguageSwitch.astro exists with accessible navigation
    - BaseLayout has dynamic lang attribute
    - Both ThemeToggle and LanguageSwitch in header
    - Active language is styled differently
  </done>
</task>

<task type="auto">
  <name>Task 3: Create English page and update German page</name>
  <files>
    src/pages/index.astro
    src/pages/en/index.astro
  </files>
  <action>
Update src/pages/index.astro (German homepage):

1. Import getLangFromUrl, useTranslations from "../i18n/ui"
2. Get lang and t function
3. Use translations for content:
   - t("hero.greeting") + " Brian Boy"
   - t("hero.tagline")
4. Pass title and description props to BaseLayout using translations

Create src/pages/en/index.astro (English homepage):

1. Nearly identical structure to German page
2. Same imports and pattern
3. Will automatically use English translations because URL is /en/

Both pages should:
- Use BaseLayout
- Display localized greeting and tagline
- Show the same structure but different language content

The goal is minimal placeholder content - real content comes in Phase 3.
  </action>
  <verify>
    npm run dev
    Visit http://localhost:4321 - German content
    Visit http://localhost:4321/en/ - English content
    Click language switcher - navigates correctly
    html lang attribute correct on each page
  </verify>
  <done>
    - / shows German content with lang="de"
    - /en/ shows English content with lang="en"
    - Language switcher navigates between pages
    - Theme toggle works on both pages
    - Build produces both language versions
  </done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Run `npm run dev`
2. Visit http://localhost:4321 (German):
   - Check html lang="de"
   - Verify German text appears
   - Language switcher shows Deutsch as active
3. Click "English" in language switcher:
   - URL changes to /en/
   - Check html lang="en"
   - Verify English text appears
   - Language switcher shows English as active
4. Click "Deutsch" to go back:
   - URL is / (not /de/)
   - German content returns
5. Theme toggle works on both pages
6. Theme persists when switching languages
7. Run `npm run build`:
   - Check dist/ has both index.html and en/index.html
</verification>

<success_criteria>
- German content at / with lang="de"
- English content at /en/ with lang="en"
- Language switcher navigates between languages
- Theme toggle works on both language pages
- Theme preference persists across language switch
- Build produces static HTML for both languages
- No /de/ prefix for German (prefixDefaultLocale: false working)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-core-systems/01-03-SUMMARY.md`
</output>
