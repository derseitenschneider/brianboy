---
phase: 04-seo-deployment
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - astro.config.mjs
  - public/robots.txt
autonomous: true
requirements:
  - REQ-013

must_haves:
  truths:
    - "Sitemap XML is generated at build time with all pages"
    - "Sitemap includes hreflang links between German and English versions"
    - "robots.txt allows all crawlers and references the sitemap"
  artifacts:
    - path: "astro.config.mjs"
      provides: "Sitemap i18n configuration with locale mapping"
      contains: "defaultLocale"
    - path: "public/robots.txt"
      provides: "Crawler directives with sitemap reference"
      contains: "sitemap-index.xml"
  key_links:
    - from: "astro.config.mjs"
      to: "dist/sitemap-0.xml"
      via: "@astrojs/sitemap integration generates sitemap at build"
      pattern: "sitemap.*i18n"
    - from: "public/robots.txt"
      to: "dist/sitemap-index.xml"
      via: "Sitemap directive URL reference"
      pattern: "Sitemap.*sitemap-index"
---

<objective>
Configure the @astrojs/sitemap integration with i18n support for proper hreflang in the sitemap XML, and add a static robots.txt that allows all crawlers.

Purpose: Search engines discover all pages and understand the language relationship between DE and EN versions.
Output: Sitemap XML with hreflang links, robots.txt with sitemap reference.
</objective>

<execution_context>
@/Users/brianboy/.claude/get-shit-done/workflows/execute-plan.md
@/Users/brianboy/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-seo-deployment/04-RESEARCH.md
@astro.config.mjs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure sitemap i18n and create robots.txt</name>
  <files>astro.config.mjs, public/robots.txt</files>
  <action>
**astro.config.mjs:**

Update the existing `sitemap()` call to include i18n configuration. Change:
```javascript
integrations: [sitemap()],
```
to:
```javascript
integrations: [
  sitemap({
    i18n: {
      defaultLocale: "de",
      locales: {
        de: "de-CH",
        en: "en",
      },
    },
  }),
],
```

This tells @astrojs/sitemap to generate `<xhtml:link rel="alternate" hreflang="...">` elements in the sitemap XML, linking the German and English versions of each page. The `defaultLocale: "de"` aligns with the site's `prefixDefaultLocale: false` setting where German pages have no URL prefix.

**public/robots.txt:**

Create a new static file with:
```
User-agent: *
Allow: /

Sitemap: https://brianboy.ch/sitemap-index.xml
```

Note: @astrojs/sitemap generates `sitemap-index.xml` as the entry point (not `sitemap.xml`), which then references individual sitemap files like `sitemap-0.xml`. The canonical domain is `https://brianboy.ch` (no www) per user decision.
  </action>
  <verify>Run `npm run build`. Check that `dist/sitemap-index.xml` exists and references `sitemap-0.xml`. Check that `dist/sitemap-0.xml` contains `<xhtml:link` elements with `hreflang="de"` and `hreflang="en"`. Verify `dist/robots.txt` exists with correct content. Verify the sitemap contains URLs for all 4 pages (/, /about/, /en/, /en/about/).</verify>
  <done>Sitemap XML generated at build time with hreflang links between DE and EN page versions. robots.txt allows all crawlers and points to sitemap-index.xml. All 4 pages appear in the sitemap.</done>
</task>

</tasks>

<verification>
1. `npm run build` succeeds
2. `dist/sitemap-index.xml` exists
3. `dist/sitemap-0.xml` contains `xhtml:link` with `hreflang="de-CH"` and `hreflang="en"`
4. `dist/sitemap-0.xml` contains URLs for /, /about/, /en/, /en/about/
5. `dist/robots.txt` contains "User-agent: *", "Allow: /", and "Sitemap: https://brianboy.ch/sitemap-index.xml"
</verification>

<success_criteria>
- Build passes
- Sitemap XML includes all 4 pages with hreflang alternate links
- robots.txt is correctly placed in dist/ with sitemap reference
</success_criteria>

<output>
After completion, create `.planning/phases/04-seo-deployment/04-02-SUMMARY.md`
</output>
