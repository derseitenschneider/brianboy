---
/**
 * MobileMenu.astro
 *
 * Mobile hamburger menu with toggle functionality.
 * Shows on screens below md breakpoint (Tailwind <768px).
 * Includes proper ARIA attributes for accessibility.
 */
import { getLangFromUrl, useTranslations, getLocalizedPath } from "../i18n/ui";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const links = [
  { href: "", label: t("nav.home") },
  { href: "about", label: t("nav.about") },
];
---

<div class="md:hidden">
  <button
    id="mobile-menu-button"
    type="button"
    aria-expanded="false"
    aria-controls="mobile-menu"
    aria-label={t("nav.menu")}
    class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
  >
    <!-- Hamburger icon (visible when menu closed) -->
    <svg
      id="menu-icon-open"
      class="w-5 h-5"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      aria-hidden="true"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4 6h16M4 12h16M4 18h16"
      />
    </svg>
    <!-- X icon (visible when menu open) -->
    <svg
      id="menu-icon-close"
      class="hidden w-5 h-5"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      aria-hidden="true"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M6 18L18 6M6 6l12 12"
      />
    </svg>
  </button>

  <nav
    id="mobile-menu"
    class="hidden absolute top-full left-0 right-0 z-50 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 shadow-lg"
  >
    <div class="px-4 py-3 space-y-1">
      {
        links.map(({ href, label }) => (
          <a
            href={getLocalizedPath(lang, href ? `/${href}` : "/")}
            class="block px-3 py-2 rounded-lg text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 hover:text-gray-900 dark:hover:text-gray-100 transition-colors"
          >
            {label}
          </a>
        ))
      }
    </div>
  </nav>
</div>

<script>
  const button = document.getElementById("mobile-menu-button");
  const menu = document.getElementById("mobile-menu");
  const iconOpen = document.getElementById("menu-icon-open");
  const iconClose = document.getElementById("menu-icon-close");

  function toggleMenu() {
    const isExpanded = button?.getAttribute("aria-expanded") === "true";
    button?.setAttribute("aria-expanded", String(!isExpanded));
    menu?.classList.toggle("hidden");
    iconOpen?.classList.toggle("hidden");
    iconClose?.classList.toggle("hidden");
  }

  button?.addEventListener("click", (e) => {
    e.stopPropagation();
    toggleMenu();
  });

  // Close menu when clicking outside
  document.addEventListener("click", (e) => {
    const target = e.target as Node;
    if (
      button?.getAttribute("aria-expanded") === "true" &&
      !menu?.contains(target) &&
      !button?.contains(target)
    ) {
      toggleMenu();
    }
  });
</script>
